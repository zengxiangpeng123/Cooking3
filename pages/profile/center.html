<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户中心 - 炒菜学习平台</title>
    <meta name="description" content="管理您的个人信息、学习进度和账户设置">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../data/imgs/图标.iconfont">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS 样式文件 -->
    <link rel="stylesheet" href="../../css/base/reset.css">
    <link rel="stylesheet" href="../../css/base/variables.css">
    <link rel="stylesheet" href="../../css/base/base.css">
    <link rel="stylesheet" href="../../css/components/header.css">
    <link rel="stylesheet" href="../../css/components/footer.css">
    <link rel="stylesheet" href="../../css/components/card.css">
    <link rel="stylesheet" href="../../css/components/cool-search.css">
    <link rel="stylesheet" href="../../css/components/text-animations.css">
    <link rel="stylesheet" href="../../css/pages/profile.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    
    <style>
        /* 用户中心专用样式 */
        .user-center {
            min-height: calc(100vh - 160px);
            padding: 40px 0;
            background: #f8f9fa;
        }
        
        /* 主布局：左导航 + 右内容 */
        .center-layout {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 左侧导航栏 */
        .center-nav {
            flex: 0 0 280px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 0;
            height: fit-content;
            position: sticky;
            top: 120px;
        }
        
        /* 用户信息卡片 */
        .user-profile-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            background: linear-gradient(135deg, #ff6b35, #ff8b5a);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            border: 4px solid rgba(255,255,255,0.3);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .profile-avatar:hover {
            transform: scale(1.05);
            border-color: rgba(255,255,255,0.6);
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.3s ease;
        }
        
        /* 头像上传覆盖层 */
        .avatar-upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .profile-avatar:hover .avatar-upload-overlay {
            opacity: 1;
        }
        
        .avatar-upload-overlay i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        .avatar-upload-overlay span {
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .profile-name {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .profile-email {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* 统计信息 */
        .stats-mini {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .stat-mini {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        
        .stat-mini:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .stat-mini__icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 8px;
        }
        
        .stat-mini__icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .stat-mini__number {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }
        
        .stat-mini__label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }
        
        /* 导航菜单 */
        .nav-menu {
            padding: 0;
        }
        
        .nav-menu__item {
            display: block;
            padding: 18px 20px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-menu__item:hover {
            background: #f8f9fa;
            color: #ff6b35;
            padding-left: 25px;
        }
        
        .nav-menu__item.active {
            background: #ff6b35;
            color: white;
            border-left: 4px solid #e55a2b;
        }
        
        .nav-menu__item:last-child {
            border-bottom: none;
            border-radius: 0 0 12px 12px;
        }
        
        .nav-menu__item i {
            width: 20px;
            margin-right: 12px;
        }
        
        /* 右侧内容区域 */
        .center-content {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-height: 600px;
        }
        
        .content-section {
            display: none;
            padding: 30px;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ff6b35;
            display: inline-block;
        }
        
        /* 统计卡片网格 - 强制四个一排 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ff6b35, #ff8b5a);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        /* 简洁的左上角光效 */
        .stat-card::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, 
                rgba(255,255,255,0.15) 0%, 
                rgba(255,255,255,0.08) 50%, 
                transparent 100%
            );
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.8;
        }
        
        /* 悬停时轻微上浮效果 */
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-card__icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 15px;
        }
        
        .stat-card__icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            /* 移除白色滤镜，显示原始图片 */
        }
        
        /* 获得成就图标特殊处理 - 放大10% */
        .stat-card__icon img[alt="获得成就"] {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.3)); /* 添加发光效果 */
        }
        
        /* 左侧小统计图标的获得成就也要放大 */
        .stat-mini__icon img[alt="获得成就"] {
            transform: scale(1.1);
        }
        
        .stat-card__number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card__label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        /* 学习记录网格 */
        .learning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* 本周学习网格 */
        .weekly-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .day-item {
            text-align: center;
            padding: 20px 10px;
            border-radius: 12px;
            transition: all 0.3s;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        
        .day-item.completed {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            transform: scale(1.02);
        }
        
        .day-item.current {
            background: linear-gradient(135deg, #ff6b35, #ff8b5a);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        .day-item.missed {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
        
        .day-item.future {
            background: #f8f9fa;
            color: #999;
            border: 2px dashed #ddd;
        }
        
        .day-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .day-status {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .day-date {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* 数据管理卡片 - 强制四个一排 */
        .data-management {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        .data-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .data-card__icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        
        .data-card__title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .data-card__desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .data-card__actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .data-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .data-btn--primary {
            background: #ff6b35;
            color: white;
        }
        
        .data-btn--primary:hover {
            background: #e55a2b;
        }
        
        .data-btn--secondary {
            background: #6c757d;
            color: white;
        }
        
        .data-btn--secondary:hover {
            background: #545b62;
        }
        
        /* 响应式设计 */
        @media (max-width: 992px) {
            .center-layout {
                flex-direction: column;
            }
            
            .center-nav {
                flex: none;
                position: static;
            }
            
            .stats-mini {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .nav-menu__item {
                display: inline-block;
                padding: 15px 20px;
                border-bottom: none;
                border-right: 1px solid #f0f0f0;
                border-radius: 0;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .nav-menu__item:last-child {
                border-right: none;
                border-radius: 0;
            }
        }
        
        @media (max-width: 768px) {
            .center-layout {
                padding: 0 15px;
            }
            
            .stats-mini {
                grid-template-columns: repeat(2, 1fr);
            }
            
            /* 手机端统计卡片改为2x2布局 */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .stat-card {
                padding: 18px;
            }
            
            .stat-card__number {
                font-size: 1.6rem;
            }
            
            .stat-card__label {
                font-size: 0.9rem;
            }
            
            /* 手机端左上角光效调小 */
            .stat-card::before {
                width: 40px;
                height: 40px;
                top: 10px;
                left: 10px;
            }
            
            /* 手机端快速操作改为2x2布局 */
            .data-management {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .learning-grid {
                grid-template-columns: 1fr;
            }
            
            .weekly-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 8px;
            }
            
            .day-item {
                padding: 15px 5px;
                min-height: 90px;
            }
            
            .day-status {
                font-size: 1.5rem;
            }
        }
        
        /* 平板端适配 */
        @media (max-width: 992px) and (min-width: 769px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .data-management {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- 页面头部 -->
    <header class="header">
        <div class="container">
            <div class="header__content">
                <div class="header__logo">
                    <a href="../../main.html" class="logo">
                        <img src="../../data/imgs/图标.png" alt="炒菜学习平台" class="logo__icon">
                        <span class="logo__text">炒菜学习平台</span>
                    </a>
                </div>
                
                <nav class="header__nav">
                    <ul class="nav__list">
                        <li class="nav__item">
                            <a href="../../main.html" class="nav__link">首页</a>
                        </li>
                        <li class="nav__item">
                            <a href="../recipes/list.html" class="nav__link">菜谱大全</a>
                        </li>
                        <li class="nav__item">
                            <a href="../guide/basics.html" class="nav__link">烹饪指南</a>
                        </li>
                        <li class="nav__item">
                            <a href="../forum/index.html" class="nav__link">美食论坛</a>
                        </li>
                        <li class="nav__item">
                            <a href="favorites.html" class="nav__link">我的收藏</a>
                        </li>
                        <li class="nav__item">
                            <a href="center.html" class="nav__link nav__link--active">用户中心</a>
                        </li>
                    </ul>
                </nav>
                
                <div class="header__search">
                    <form class="search__form" id="searchForm">
                        <input type="text" class="search__input" placeholder="搜索菜谱或食材..." id="searchInput">
                        <button type="submit" class="search__btn">
                            <span class="search__icon">🔍</span>
                        </button>
                    </form>
                </div>
                
                <button class="header__menu-btn" id="mobileMenuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- 用户中心主要内容 -->
    <main class="user-center">
        <div class="center-layout">
            <!-- 左侧导航栏 -->
            <aside class="center-nav">
                <!-- 用户信息头部 -->
                <div class="user-profile-header">
                    <div class="profile-avatar" id="avatarContainer" title="点击更换头像">
                        <img src="../../assets/images/avatars/default.png" alt="用户头像" id="profileAvatar" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iNDAiIGZpbGw9IiNmZjZiMzUiLz4KPHN2ZyB4PSIyMCIgeT0iMjAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0id2hpdGUiPgo8c3ZnIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDQwIDQwIiBmaWxsPSJub25lIj4KPHBhdGggZD0iTTIwIDIwQzI0IDIwIDI4IDE2IDI4IDE2QzI4IDEyIDI0IDggMjAgOEMxNiA4IDEyIDEyIDEyIDE2QzEyIDE2IDE2IDIwIDIwIDIwWiIgZmlsbD0iY3VycmVudENvbG9yIi8+CjxwYXRoIGQ9Ik0yMCAyNEMxNiAyNCA4IDI4IDggMzZDOCAzNiAxMiA0MCAyMCA0MEMyOCA0MCAzMiAzNiAzMiAzNkMzMiAyOCAyNCAyNCAyMCAyNFoiIGZpbGw9ImN1cnJlbnRDb2xvciIvPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPgo=';">
                        <!-- 头像上传按钮覆盖层 -->
                        <div class="avatar-upload-overlay">
                                    <i class="fas fa-camera"></i>
                            <span>更换头像</span>
                        </div>
                    </div>
                                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    <div class="profile-name" id="profileName">用户名</div>
                    <div class="profile-email" id="profileEmail">email@example.com</div>
                            </div>
                
                <!-- 快速统计 -->
                <div class="stats-mini">
                    <div class="stat-mini">
                        <div class="stat-mini__icon">
                            <img src="../../data/imgs/用户中心/已学菜谱.png" alt="已学菜谱" onerror="this.style.display='none'; this.parentElement.innerHTML='📚';">
                        </div>
                        <div class="stat-mini__number" id="learnedRecipesCount">0</div>
                        <div class="stat-mini__label">已学菜谱</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini__icon">
                            <img src="../../data/imgs/用户中心/收藏菜谱.png" alt="收藏菜谱" onerror="this.style.display='none'; this.parentElement.innerHTML='❤️';">
                        </div>
                        <div class="stat-mini__number" id="favoriteRecipesCount">0</div>
                        <div class="stat-mini__label">收藏菜谱</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini__icon">
                            <img src="../../data/imgs/用户中心/学习天数.png" alt="学习天数" onerror="this.style.display='none'; this.parentElement.innerHTML='📅';">
                        </div>
                        <div class="stat-mini__number" id="studyDaysCount">0</div>
                        <div class="stat-mini__label">学习天数</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini__icon">
                            <img src="../../data/imgs/用户中心/获得成就.png" alt="获得成就" onerror="this.style.display='none'; this.parentElement.innerHTML='🏆';">
                        </div>
                        <div class="stat-mini__number" id="achievementsCount">0</div>
                        <div class="stat-mini__label">获得成就</div>
                            </div>
                        </div>
                        
                <!-- 导航菜单 -->
                <nav class="nav-menu">
                    <a class="nav-menu__item active" data-section="overview" href="#overview">
                        <i class="fas fa-tachometer-alt"></i>
                        数据总览
                    </a>
                    <a class="nav-menu__item" data-section="learning" href="#learning">
                        <i class="fas fa-book-open"></i>
                        最近学习
                    </a>
                    <a class="nav-menu__item" data-section="weekly" href="#weekly">
                        <i class="fas fa-calendar-week"></i>
                        本周计划
                    </a>
                    <a class="nav-menu__item" data-section="profile" href="#profile">
                        <i class="fas fa-user-edit"></i>
                        个人信息
                    </a>
                    <a class="nav-menu__item" data-section="data" href="#data">
                        <i class="fas fa-database"></i>
                        数据管理
                    </a>
                    <a class="nav-menu__item" data-section="security" href="#security">
                                <i class="fas fa-shield-alt"></i>
                                账户安全
                            </a>
                    <a class="nav-menu__item" data-section="help" href="#help">
                                <i class="fas fa-question-circle"></i>
                                帮助中心
                            </a>
                        </nav>
            </aside>
            
            <!-- 右侧内容区域 -->
            <main class="center-content">
                <!-- 数据总览 -->
                <section class="content-section active" id="overviewSection">
                    <h2 class="section-title page-title-animated animate-gradient-text">数据总览</h2>
                    
                    <!-- 详细统计卡片 -->
                    <div class="stats-grid cards-animated">
                        <div class="stat-card">
                            <div class="stat-card__icon">
                                <img src="../../data/imgs/用户中心/已学菜谱.png" alt="已学菜谱">
                            </div>
                            <div class="stat-card__number" id="totalLearnedRecipes">0</div>
                            <div class="stat-card__label">已学菜谱</div>
                                    </div>
                        <div class="stat-card">
                            <div class="stat-card__icon">
                                <img src="../../data/imgs/用户中心/收藏菜谱.png" alt="收藏菜谱">
                                    </div>
                            <div class="stat-card__number" id="totalFavoriteRecipes">0</div>
                            <div class="stat-card__label">收藏菜谱</div>
                                    </div>
                        <div class="stat-card">
                            <div class="stat-card__icon">
                                <img src="../../data/imgs/用户中心/学习天数.png" alt="学习天数">
                                    </div>
                            <div class="stat-card__number" id="totalStudyDays">0</div>
                            <div class="stat-card__label">学习天数</div>
                                    </div>
                        <div class="stat-card">
                            <div class="stat-card__icon">
                                <img src="../../data/imgs/用户中心/获得成就.png" alt="获得成就">
                                    </div>
                            <div class="stat-card__number" id="totalAchievements">0</div>
                            <div class="stat-card__label">获得成就</div>
                                </div>
                            </div>
                            
                    <!-- 快速操作 -->
                    <h3 style="margin: 40px 0 20px 0; font-size: 1.4rem; color: #333;">快速操作</h3>
                    <div class="data-management">
                        <div class="data-card">
                            <div class="data-card__icon">🔍</div>
                            <h4 class="data-card__title">浏览菜谱</h4>
                            <p class="data-card__desc">发现更多美味菜谱</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="window.location.href='../recipes/list.html'">
                                    立即浏览
                                </button>
                                        </div>
                                        </div>
                        <div class="data-card">
                            <div class="data-card__icon">❤️</div>
                            <h4 class="data-card__title">我的收藏</h4>
                            <p class="data-card__desc">查看收藏的菜谱</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="window.location.href='favorites.html'">
                                    查看收藏
                                </button>
                                        </div>
                                        </div>
                        <div class="data-card">
                            <div class="data-card__icon">💬</div>
                            <h4 class="data-card__title">美食论坛</h4>
                            <p class="data-card__desc">与厨友交流心得</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="window.location.href='../forum/index.html'">
                                    进入论坛
                                        </button>
                                    </div>
                            </div>
                        <div class="data-card">
                            <div class="data-card__icon">📖</div>
                            <h4 class="data-card__title">烹饪指南</h4>
                            <p class="data-card__desc">学习烹饪技巧</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="window.location.href='../guide/basics.html'">
                                    学习技巧
                                </button>
                        </div>
                                    </div>
                                        </div>
                </section>
                
                <!-- 最近学习 -->
                <section class="content-section" id="learningSection">
                    <h2 class="section-title">最近学习</h2>
                    
                    <div class="section-actions" style="margin-bottom: 20px; text-align: right;">
                        <button class="data-btn data-btn--secondary" onclick="openFullLearningHistory()">
                            <i class="fas fa-history"></i>
                            查看全部记录
                                        </button>
                        <button class="data-btn data-btn--secondary" onclick="clearLearningHistory()" style="margin-left: 10px;">
                            <i class="fas fa-trash"></i>
                            清空记录
                                        </button>
                                </div>
                                
                    <div class="learning-grid" id="learningGrid">
                        <!-- 最近学习记录将通过JavaScript动态生成 -->
                                    </div>
                    
                    <div class="empty-state" id="learningEmpty" style="display: none; text-align: center; padding: 60px 20px; color: #666;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">📚</div>
                        <h3>还没有学习记录</h3>
                        <p>浏览菜谱详情页面即会自动记录学习历史</p>
                        <button class="data-btn data-btn--primary" onclick="window.location.href='../recipes/list.html'" style="margin-top: 15px;">
                            开始学习菜谱
                                        </button>
                                    </div>
                </section>
                
                <!-- 本周计划 -->
                <section class="content-section" id="weeklySection">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 class="section-title" style="margin-bottom: 0;">本周学习计划 <span id="currentWeekRange" style="font-size: 1rem; color: #666; font-weight: normal;"></span></h2>
                        <div class="plan-actions">
                            <button class="data-btn data-btn--secondary" onclick="editWeeklyPlan()" style="margin-right: 10px;">
                                <i class="fas fa-edit"></i>
                                编辑计划
                            </button>
                            <button class="data-btn data-btn--primary" onclick="setWeeklyGoal()">
                                <i class="fas fa-target"></i>
                                设定目标
                            </button>
                        </div>
                    </div>
                    
                    <!-- 当前目标显示 -->
                    <div class="current-goal" id="currentGoal" style="
                        background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
                        border: 1px solid #4caf50;
                        border-radius: 8px;
                        padding: 20px;
                        margin-bottom: 30px;
                        display: none;
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0 0 8px 0; color: #2e7d32; font-size: 1.1rem;">📋 本周目标</h4>
                                <p id="goalDescription" style="margin: 0; color: #388e3c; font-size: 0.95rem;"></p>
                            </div>
                            <div class="goal-progress" style="text-align: center;">
                                <div id="goalProgress" style="font-size: 1.2rem; font-weight: 600; color: #2e7d32;"></div>
                                <div style="font-size: 0.8rem; color: #666; margin-top: 4px;">完成进度</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weekly-grid" id="weeklyGrid">
                        <!-- 本周学习状态将通过JavaScript动态生成 -->
                    </div>
                    
                    <div class="weekly-summary" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; margin-top: 30px;">
                        <div style="display: flex; justify-content: space-around; align-items: center;">
                            <div>
                                <strong id="completedDaysCount" style="font-size: 1.5rem; color: #4caf50;">0</strong>
                                <div style="color: #666; font-size: 0.9rem;">天已学习</div>
                            </div>
                            <div style="height: 40px; width: 1px; background: #ddd;"></div>
                            <div>
                                <strong id="remainingDaysCount" style="font-size: 1.5rem; color: #ff6b35;">7</strong>
                                <div style="color: #666; font-size: 0.9rem;">天待学习</div>
                            </div>
                            <div style="height: 40px; width: 1px; background: #ddd;"></div>
                            <div>
                                <strong id="weeklyGoalProgress" style="font-size: 1.5rem; color: #2196f3;">0%</strong>
                                <div style="color: #666; font-size: 0.9rem;">目标完成</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 计划建议 -->
                    <div class="plan-suggestions" id="planSuggestions" style="margin-top: 30px;">
                        <!-- 计划建议将通过JavaScript动态生成 -->
                    </div>
                </section>
                
                <!-- 个人信息 -->
                <section class="content-section" id="profileSection">
                    <h2 class="section-title">个人信息</h2>
                    
                    <div class="profile-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0; color: #333;">基本信息</h4>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">用户名</label>
                                <span id="displayUsername">用户名</span>
                                    </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">邮箱地址</label>
                                <span id="displayEmail">email@example.com</span>
                                </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">注册时间</label>
                                <span>2024年10月</span>
                                    </div>
                                </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0; color: #333;">扩展信息</h4>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">手机号码</label>
                                <span id="displayPhone">未绑定</span>
                                    </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">真实姓名</label>
                                <span id="displayRealName">未设置</span>
                            </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">所在地区</label>
                                <span id="displayLocation">未设置</span>
                            </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">个人简介</label>
                                <span id="displayBio">热爱美食的烹饪爱好者</span>
                            </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">兴趣标签</label>
                                <span id="displayInterests">未设置</span>
                            </div>
                            <div class="info-item" style="margin: 12px 0;">
                                <label style="display: block; font-weight: 600; color: #666; margin-bottom: 4px;">最后活跃</label>
                                <span>今天</span>
                            </div>
                        </div>
                                        </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="data-btn data-btn--primary" onclick="window.location.href='edit.html'">
                            <i class="fas fa-edit"></i>
                            编辑资料
                        </button>
                        <button class="data-btn data-btn--secondary" onclick="refreshProfile()" style="margin-left: 10px;">
                            <i class="fas fa-sync-alt"></i>
                            刷新信息
                        </button>
                    </div>
                </section>
                
                <!-- 数据管理 -->
                <section class="content-section" id="dataSection">
                    <h2 class="section-title">数据管理</h2>
                    
                    <div class="data-management">
                        <div class="data-card">
                            <div class="data-card__icon">💾</div>
                            <h4 class="data-card__title">收藏管理</h4>
                            <p class="data-card__desc">导入导出您的收藏数据</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="exportFavorites()">
                                            <i class="fas fa-download"></i>
                                            导出收藏
                                        </button>
                                <button class="data-btn data-btn--secondary" onclick="importFavorites()">
                                    <i class="fas fa-upload"></i>
                                    导入收藏
                                        </button>
                                    </div>
                            <input type="file" id="favoritesFileInput" accept=".json" style="display: none;">
                                </div>
                                
                        <div class="data-card">
                            <div class="data-card__icon">🔄</div>
                            <h4 class="data-card__title">数据备份</h4>
                            <p class="data-card__desc">备份恢复所有用户数据</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="backupAllData()">
                                    <i class="fas fa-download"></i>
                                        备份数据
                                    </button>
                                <button class="data-btn data-btn--secondary" onclick="importAllData()">
                                    <i class="fas fa-upload"></i>
                                    恢复数据
                                    </button>
                                </div>
                            <input type="file" id="backupFileInput" accept=".json" style="display: none;">
                                </div>
                                
                        <div class="data-card">
                            <div class="data-card__icon">🧹</div>
                            <h4 class="data-card__title">数据清理</h4>
                            <p class="data-card__desc">清理和重置用户数据</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--secondary" onclick="clearLearningHistory()">
                                    清空学习记录
                                </button>
                                <button class="data-btn data-btn--secondary" onclick="clearAllData()" style="margin-top: 8px;">
                                    重置所有数据
                                    </button>
                                </div>
                            </div>
                        </div>
                </section>
                
                <!-- 账户安全 -->
                <section class="content-section" id="securitySection">
                    <h2 class="section-title">账户安全</h2>
                    
                    <div class="data-management">
                        <div class="data-card">
                            <div class="data-card__icon">🔒</div>
                            <h4 class="data-card__title">密码管理</h4>
                            <p class="data-card__desc">修改登录密码</p>
                            <div class="data-card__actions">
                                <button class="data-btn data-btn--primary" onclick="changePassword()">
                                    <i class="fas fa-key"></i>
                                    修改密码
                                </button>
                                    </div>
                                </div>
                                
                        <div class="data-card">
                            <div class="data-card__icon">📱</div>
                            <h4 class="data-card__title">二步验证</h4>
                            <p class="data-card__desc">增强账户安全性</p>
                            <div class="data-card__actions">
                                <label style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                                    <input type="checkbox" id="twoFactorToggle">
                                    <span>启用二步验证</span>
                                    </label>
                                </div>
                                    </div>
                                </div>
                </section>
                
                <!-- 帮助中心 -->
                <section class="content-section" id="helpSection">
                    <h2 class="section-title">帮助中心</h2>
                    
                    <div class="data-management">
                        <div class="data-card">
                            <div class="data-card__icon">❓</div>
                            <h4 class="data-card__title">常见问题</h4>
                            <p class="data-card__desc">查看常见问题解答</p>
                            <div style="text-align: left; margin-top: 15px;">
                                <ul style="list-style: none; padding: 0;">
                                    <li style="margin: 8px 0;"><a href="#" style="color: #ff6b35; text-decoration: none;">• 如何收藏菜谱？</a></li>
                                    <li style="margin: 8px 0;"><a href="#" style="color: #ff6b35; text-decoration: none;">• 如何查看学习记录？</a></li>
                                    <li style="margin: 8px 0;"><a href="#" style="color: #ff6b35; text-decoration: none;">• 如何备份数据？</a></li>
                                    <li style="margin: 8px 0;"><a href="#" style="color: #ff6b35; text-decoration: none;">• 如何分享菜谱？</a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="data-card">
                            <div class="data-card__icon">📞</div>
                            <h4 class="data-card__title">联系我们</h4>
                            <p class="data-card__desc">获得技术支持</p>
                            <div style="text-align: left; margin-top: 15px; font-size: 0.9rem; color: #666;">
                                <div style="margin: 8px 0;"><i class="fas fa-envelope" style="color: #ff6b35; margin-right: 8px;"></i>support@cooking-platform.com</div>
                                <div style="margin: 8px 0;"><i class="fas fa-phone" style="color: #ff6b35; margin-right: 8px;"></i>400-123-4567</div>
                                <div style="margin: 8px 0;"><i class="fas fa-clock" style="color: #ff6b35; margin-right: 8px;"></i>工作时间：9:00-18:00</div>
                            </div>
                                    </div>
                                </div>
                                
                    <!-- 意见反馈 -->
                    <h3 style="margin: 40px 0 20px 0; font-size: 1.4rem; color: #333;">意见反馈</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <textarea id="feedbackText" placeholder="请告诉我们您的建议或遇到的问题..." 
                                  style="width: 100%; height: 100px; border: 1px solid #ddd; border-radius: 6px; padding: 12px; resize: vertical;"></textarea>
                        <div style="margin-top: 15px; text-align: right;">
                            <button class="data-btn data-btn--primary" onclick="submitFeedback()">
                                                    <i class="fas fa-paper-plane"></i>
                                                    提交反馈
                                                </button>
                </div>
            </div>
        </section>
            </main>
        </div>
    </main>

    <!-- 页面底部 -->
    <footer class="footer">
        <div class="container">
            <div class="footer__content">
                <div class="footer__section">
                    <h3 class="footer__title">关于我们</h3>
                    <p class="footer__text">炒菜学习平台致力于传播中华美食文化，让每个人都能轻松学会做菜。</p>
                </div>
                <div class="footer__section">
                    <h3 class="footer__title">快速链接</h3>
                    <ul class="footer__links">
                        <li><a href="../recipes/list.html">菜谱大全</a></li>
                        <li><a href="../guide/basics.html">烹饪基础</a></li>
                        <li><a href="favorites.html">我的收藏</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h3 class="footer__title">联系方式</h3>
                    <ul class="footer__contact">
                        <li>📧 contact@cooking-platform.com</li>
                        <li>📱 400-123-4567</li>
                    </ul>
                </div>
            </div>
            <div class="footer__bottom">
                <p>&copy; 2024 炒菜学习平台. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript 文件 -->
    <script src="../../js/utils/global-search.js"></script>
    <script src="../../js/utils/storage.js"></script>
    <script src="../../js/utils/dom.js"></script>
    <script src="../../js/utils/api.js"></script>
    <script src="../../js/data/recipes.js"></script>
    <script src="../../js/data/categories.js"></script>
    <script src="../../js/utils/user-center-manager.js"></script>
    <script src="../../js/utils/data-migration.js"></script>
    <script src="../../js/components/header.js"></script>
    <script src="../../js/components/search.js"></script>

    <script>
        // 用户中心页面管理
        class UserCenterPage {
            constructor() {
                this.currentSection = 'overview';
                this.init();
            }

            init() {
                console.log('🚀 用户中心页面初始化...');
                this.bindNavigation();
                this.loadUserInfo();
                this.updateAllStats();
                this.setupFileInputs();
                this.setupAvatarUpload();
                
                // 等待用户中心管理系统加载完成
                this.waitForManager(() => {
                    this.renderContent();
                });
            }

            waitForManager(callback, attempts = 0) {
                if (window.userCenterManager || attempts > 20) {
                    callback();
                } else {
                    setTimeout(() => {
                        this.waitForManager(callback, attempts + 1);
                    }, 100);
                }
            }

            bindNavigation() {
                const navItems = document.querySelectorAll('.nav-menu__item');
                
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        const section = item.getAttribute('data-section');
                        if (section) {
                            this.showSection(section);
                            
                            // 更新导航状态
                            navItems.forEach(nav => nav.classList.remove('active'));
                            item.classList.add('active');
                        }
                    });
                });
            }

            showSection(sectionName) {
                // 隐藏所有内容区域
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => section.classList.remove('active'));
                
                // 显示目标区域
                const targetSection = document.getElementById(sectionName + 'Section');
                if (targetSection) {
                    targetSection.classList.add('active');
                    this.currentSection = sectionName;
                    console.log('切换到:', sectionName);
                    
                    // 根据区域渲染相应内容
                    this.renderSectionContent(sectionName);
                }
            }

            renderSectionContent(sectionName) {
                switch (sectionName) {
                    case 'learning':
                        this.renderLearningHistory();
                        break;
                    case 'weekly':
                        this.renderWeeklyPlan();
                        break;
                    case 'overview':
                        this.updateAllStats();
                        break;
                }
            }

            renderLearningHistory() {
                if (window.userCenterManager) {
                    window.userCenterManager.renderRecentLearning();
                }
            }

            renderWeeklyPlan() {
                if (window.userCenterManager) {
                    window.userCenterManager.renderWeeklyLearning();
                }
                
                // 更新本周目标和计划建议
                setTimeout(() => {
                    updateWeeklyGoalDisplay();
                    updatePlanSuggestions();
                }, 100);
            }

            loadUserInfo() {
                const username = localStorage.getItem('username') || '用户名';
                const email = localStorage.getItem('email') || 'email@example.com';
                const phone = localStorage.getItem('phone') || '未绑定';
                const bio = localStorage.getItem('bio') || '热爱美食的烹饪爱好者';
                const realName = localStorage.getItem('realName') || '';
                const location = localStorage.getItem('location') || '';
                const savedAvatar = localStorage.getItem('userAvatar') || '';
                
                // 更新显示
                document.getElementById('profileName').textContent = username;
                document.getElementById('profileEmail').textContent = email;
                document.getElementById('displayUsername').textContent = username;
                document.getElementById('displayEmail').textContent = email;
                document.getElementById('displayPhone').textContent = phone || '未绑定';
                document.getElementById('displayBio').textContent = bio;
                
                // 更新头像
                if (savedAvatar) {
                    const avatarImg = document.getElementById('profileAvatar');
                    if (avatarImg) {
                        avatarImg.src = savedAvatar;
                    }
                }
                
                // 更新额外信息显示（如果存在对应元素）
                const displayRealName = document.getElementById('displayRealName');
                if (displayRealName) {
                    displayRealName.textContent = realName || '未设置';
                }
                
                const displayLocation = document.getElementById('displayLocation');
                if (displayLocation) {
                    displayLocation.textContent = location || '未设置';
                }
                
                const displayInterests = document.getElementById('displayInterests');
                if (displayInterests) {
                    const interests = localStorage.getItem('interests') || '';
                    displayInterests.textContent = interests || '未设置';
                }
                
                console.log('✅ 用户信息已更新', { username, email, phone, bio });
            }

            updateAllStats() {
                if (window.userCenterManager) {
                    const stats = window.userCenterManager.getStats();
                    
                    // 更新左侧小统计
                    document.getElementById('learnedRecipesCount').textContent = stats.learnedRecipes;
                    document.getElementById('favoriteRecipesCount').textContent = stats.favoriteCount;
                    document.getElementById('studyDaysCount').textContent = stats.studyDays;
                    document.getElementById('achievementsCount').textContent = stats.achievements;
                    
                    // 更新总览页面大统计
                    document.getElementById('totalLearnedRecipes').textContent = stats.learnedRecipes;
                    document.getElementById('totalFavoriteRecipes').textContent = stats.favoriteCount;
                    document.getElementById('totalStudyDays').textContent = stats.studyDays;
                    document.getElementById('totalAchievements').textContent = stats.achievements;
                        } else {
                    console.log('用户中心管理系统未加载，使用基础统计');
                    // 使用统一的UserPreferences系统获取收藏数据
                    let favoriteCount = 0;
                    if (window.UserPreferences) {
                        favoriteCount = window.UserPreferences.getFavorites().length;
                    } else {
                        // 降级到旧系统
                        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                        favoriteCount = favorites.length;
                    }
                    document.getElementById('favoriteRecipesCount').textContent = favoriteCount;
                    document.getElementById('totalFavoriteRecipes').textContent = favoriteCount;
                }
            }

            renderContent() {
                this.renderLearningHistory();
                this.renderWeeklyPlan();
            }

            setupFileInputs() {
                // 收藏文件导入
                const favoritesInput = document.getElementById('favoritesFileInput');
                if (favoritesInput) {
                    favoritesInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file && window.userCenterManager) {
                            window.userCenterManager.handleFileImport(file, 'favorites');
                        }
                    });
                }
                
                // 备份文件导入
                const backupInput = document.getElementById('backupFileInput');
                if (backupInput) {
                    backupInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file && window.userCenterManager) {
                            window.userCenterManager.handleFileImport(file, 'backup');
                        }
                    });
                }
            }

            setupAvatarUpload() {
                const avatarContainer = document.getElementById('avatarContainer');
                const avatarInput = document.getElementById('avatarInput');
                const avatarImg = document.getElementById('profileAvatar');
                
                if (avatarContainer && avatarInput && avatarImg) {
                    // 点击头像触发文件选择
                    avatarContainer.addEventListener('click', () => {
                        avatarInput.click();
                    });
                    
                    // 处理文件选择
                    avatarInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file && file.type.startsWith('image/')) {
                            this.handleAvatarUpload(file, avatarImg);
                        }
                    });
                    
                    // 加载已保存的头像
                    this.loadSavedAvatar(avatarImg);
                }
            }

            handleAvatarUpload(file, avatarImg) {
                // 检查文件大小（限制为2MB）
                if (file.size > 2 * 1024 * 1024) {
                    showToast('头像文件大小不能超过2MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const newAvatar = e.target.result;
                    
                    // 更新头像显示
                    avatarImg.src = newAvatar;
                    
                    // 保存到本地存储
                    localStorage.setItem('userAvatar', newAvatar);
                    
                    // 通知其他页面更新头像
                    const avatarEvent = new CustomEvent('avatarChanged', {
                        detail: { avatar: newAvatar }
                    });
                    window.dispatchEvent(avatarEvent);
                    
                    showToast('头像更新成功！', 'success');
                    console.log('✅ 头像已更新');
                };
                
                reader.onerror = () => {
                    showToast('头像上传失败，请重试', 'error');
                };
                
                reader.readAsDataURL(file);
            }

            loadSavedAvatar(avatarImg) {
                const savedAvatar = localStorage.getItem('userAvatar');
                if (savedAvatar && avatarImg) {
                    avatarImg.src = savedAvatar;
                    console.log('✅ 已加载保存的头像');
                }
            }
        }

        // 全局函数 - 使用统一的UserPreferences系统
        function exportFavorites() {
            if (!window.UserPreferences) {
                showToast('收藏系统未加载，请刷新页面重试', 'error');
                return;
            }
            
            const favorites = window.UserPreferences.getFavorites();
            const dataStr = JSON.stringify(favorites, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `我的收藏_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('收藏数据已导出', 'success');
        }

        function importFavorites() {
            document.getElementById('favoritesFileInput').click();
        }
        
        function backupAllData() {
            if (!window.UserPreferences) {
                showToast('用户系统未加载，请刷新页面重试', 'error');
                return;
            }
            
            // 使用统一的系统导出数据
            const allData = {
                username: localStorage.getItem('username'),
                email: localStorage.getItem('email'),
                phone: localStorage.getItem('phone'),
                bio: localStorage.getItem('bio'),
                favorites: window.UserPreferences.getFavorites(), // 使用UserPreferences
                learning_history: JSON.parse(localStorage.getItem('learning_history') || '[]'),
                userAvatar: localStorage.getItem('userAvatar'),
                searchHistory: window.UserPreferences.getSearchHistory(),
                backupDate: new Date().toISOString(),
                dataVersion: '2.0' // 标记数据版本
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `炒菜平台数据备份_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('数据备份已下载', 'success');
            console.log('✅ 备份数据导出成功，使用UserPreferences系统');
        }

        function importAllData() {
            document.getElementById('backupFileInput').click();
        }

        function clearLearningHistory() {
            if (confirm('确定要清空所有学习记录吗？此操作不可恢复！')) {
                localStorage.removeItem('learning_history');
                showToast('学习记录已清空', 'info');
                window.userCenterPage.updateAllStats();
                window.userCenterPage.renderContent();
            }
        }

        function clearAllData() {
            if (confirm('⚠️ 警告：此操作将清空所有数据（收藏、学习记录、个人设置等），且不可恢复！\n\n确定要继续吗？')) {
                localStorage.clear();
                showToast('所有数据已清空，即将重新加载页面...', 'info');
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }

        // 刷新个人信息显示
        function refreshProfile() {
            if (window.userCenterPage) {
                window.userCenterPage.loadUserInfo();
                window.userCenterPage.updateAllStats();
                showToast('个人信息已刷新', 'success');
            }
        }

        function changePassword() {
            const newPassword = prompt('请输入新密码（至少6位字符）:');
            if (newPassword && newPassword.length >= 6) {
                localStorage.setItem('userPassword', newPassword);
                showToast('密码修改成功', 'success');
            } else if (newPassword) {
                showToast('密码长度至少需要6位字符', 'error');
            }
        }

        function openFullLearningHistory() {
            window.location.href = 'learning-history.html';
        }

        // 本周计划功能
        function setWeeklyGoal() {
            const currentGoal = localStorage.getItem('weeklyGoal');
            const goalText = prompt('请设置本周学习目标:', currentGoal || '每天学习一道新菜谱');
            
            if (goalText && goalText.trim()) {
                const goalData = {
                    description: goalText.trim(),
                    targetDays: parseInt(prompt('目标学习天数 (1-7):', '5')) || 5,
                    setDate: new Date().toISOString(),
                    weekStart: getWeekStart().toISOString()
                };
                
                localStorage.setItem('weeklyGoal', JSON.stringify(goalData));
                showToast('本周目标设定成功！', 'success');
                
                // 更新显示
                updateWeeklyGoalDisplay();
                window.userCenterPage.renderWeeklyPlan();
            }
        }
        
        function editWeeklyPlan() {
            const plans = JSON.parse(localStorage.getItem('dailyPlans') || '{}');
            const today = new Date().toISOString().split('T')[0];
            
            const planText = prompt('请输入今天的学习计划:', plans[today] || '');
            
            if (planText !== null) { // 允许空字符串（清除计划）
                if (planText.trim()) {
                    plans[today] = planText.trim();
                    showToast('今日计划已更新', 'success');
                } else {
                    delete plans[today];
                    showToast('今日计划已清除', 'info');
                }
                
                localStorage.setItem('dailyPlans', JSON.stringify(plans));
                
                // 更新显示
                updatePlanSuggestions();
            }
        }
        
        // 更新本周目标显示
        function updateWeeklyGoalDisplay() {
            const goalContainer = document.getElementById('currentGoal');
            const goalDescription = document.getElementById('goalDescription');
            const goalProgress = document.getElementById('goalProgress');
            const weeklyGoalProgress = document.getElementById('weeklyGoalProgress');
            
            const goalData = JSON.parse(localStorage.getItem('weeklyGoal') || 'null');
            
            if (goalData && goalContainer && goalDescription && goalProgress) {
                goalContainer.style.display = 'block';
                goalDescription.textContent = goalData.description;
                
                // 计算完成进度
                const completedDays = document.getElementById('completedDaysCount')?.textContent || '0';
                const progress = Math.round((parseInt(completedDays) / goalData.targetDays) * 100);
                
                goalProgress.textContent = `${completedDays}/${goalData.targetDays}`;
                if (weeklyGoalProgress) {
                    weeklyGoalProgress.textContent = `${progress}%`;
                }
            } else if (goalContainer) {
                goalContainer.style.display = 'none';
                if (weeklyGoalProgress) {
                    weeklyGoalProgress.textContent = '未设定';
                }
            }
        }
        
        // 更新计划建议
        function updatePlanSuggestions() {
            const container = document.getElementById('planSuggestions');
            if (!container) return;
            
            const plans = JSON.parse(localStorage.getItem('dailyPlans') || '{}');
            const today = new Date().toISOString().split('T')[0];
            const todayPlan = plans[today];
            
            let suggestionsHTML = '<h3 style="margin-bottom: 20px; font-size: 1.2rem; color: #333;">💡 学习建议</h3>';
            
            if (todayPlan) {
                suggestionsHTML += `
                    <div class="today-plan" style="
                        background: #e3f2fd;
                        border-left: 4px solid #2196f3;
                        padding: 15px;
                        border-radius: 6px;
                        margin-bottom: 20px;
                    ">
                        <h4 style="margin: 0 0 8px 0; color: #1976d2;">📝 今日计划</h4>
                        <p style="margin: 0; color: #1976d2;">${todayPlan}</p>
                    </div>
                `;
            }
            
            // 添加推荐菜谱
            const recommendations = getWeeklyRecommendations();
            if (recommendations.length > 0) {
                suggestionsHTML += `
                    <div class="recipe-recommendations">
                        <h4 style="margin: 15px 0; color: #333;">🍳 推荐学习菜谱</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            ${recommendations.map(recipe => `
                                <div class="mini-recipe-card" style="
                                    background: white;
                                    border: 1px solid #e9ecef;
                                    border-radius: 8px;
                                    padding: 15px;
                                    text-align: center;
                                ">
                                    <div style="font-size: 1.5rem; margin-bottom: 8px;">${getCuisineIcon(recipe.cuisine)}</div>
                                    <h5 style="margin: 0 0 5px 0; font-size: 0.9rem;">${recipe.title}</h5>
                                    <div style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">${recipe.cookTime}</div>
                                    <button class="data-btn data-btn--primary" onclick="window.location.href='../recipes/detail.html?id=${recipe.id}'" style="font-size: 0.8rem; padding: 6px 12px;">
                                        开始学习
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = suggestionsHTML;
        }
        
        // 获取本周推荐菜谱
        function getWeeklyRecommendations() {
            if (!window.RecipeData || !window.RecipeData.recipes) return [];
            
            const history = JSON.parse(localStorage.getItem('learning_history') || '[]');
            const learnedIds = new Set(history.map(h => h.recipeId));
            
            // 推荐未学过的简单菜谱
            const unlearned = window.RecipeData.recipes.filter(recipe => 
                !learnedIds.has(recipe.id) && 
                recipe.difficulty === 'easy'
            );
            
            // 随机选择3道
            const shuffled = unlearned.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 3);
        }
        
        // 获取菜系图标
        function getCuisineIcon(cuisine) {
            const icons = {
                'sichuan': '🌶️',
                'cantonese': '🦐', 
                'hunan': '🔥',
                'shandong': '🐟'
            };
            return icons[cuisine] || '🍽️';
        }
        
        // 获取本周开始日期
        function getWeekStart() {
            const now = new Date();
            const monday = new Date(now.setDate(now.getDate() - now.getDay() + 1));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function submitFeedback() {
            const feedback = document.getElementById('feedbackText').value.trim();
            if (feedback) {
                // 保存反馈到localStorage（实际应用中应该发送到服务器）
                const feedbacks = JSON.parse(localStorage.getItem('user_feedbacks') || '[]');
                feedbacks.push({
                    content: feedback,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('user_feedbacks', JSON.stringify(feedbacks));
                
                document.getElementById('feedbackText').value = '';
                showToast('感谢您的反馈！我们会认真考虑您的建议', 'success');
            } else {
                showToast('请填写反馈内容', 'error');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                font-size: 14px;
                font-weight: 500;
                opacity: 0;
                transform: translateX(100px);
                transition: all 0.3s ease;
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 10);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100px)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            window.userCenterPage = new UserCenterPage();
            
            // 验证收藏系统同步
            setTimeout(() => {
                testFavoriteSystemSync();
            }, 1000);
            
            // 二步验证开关
            const twoFactorToggle = document.getElementById('twoFactorToggle');
            if (twoFactorToggle) {
                const saved = localStorage.getItem('twoFactorEnabled');
                twoFactorToggle.checked = saved === 'true';
                
                twoFactorToggle.addEventListener('change', function() {
                    localStorage.setItem('twoFactorEnabled', this.checked);
                    showToast(this.checked ? '二步验证已启用' : '二步验证已关闭', 'info');
                });
            }
            
            // 监听个人资料更新事件
            window.addEventListener('profileUpdated', (e) => {
                console.log('收到个人资料更新事件', e.detail);
                // 刷新显示
                if (window.userCenterPage) {
                    window.userCenterPage.loadUserInfo();
                }
                showToast('个人资料已同步更新', 'success');
            });
        });
        
        // 测试收藏系统同步
        function testFavoriteSystemSync() {
            if (window.UserPreferences) {
                const favorites = window.UserPreferences.getFavorites();
                console.log('✅ 收藏系统同步测试通过');
                console.log('当前收藏数量:', favorites.length);
                console.log('收藏系统使用的存储键:', 'cooking_favorites');
                console.log('收藏列表预览:', favorites.slice(0, 5));
                
                // 检查是否有旧数据需要迁移
                const oldFavorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                if (oldFavorites.length > 0 && favorites.length === 0) {
                    console.log('⚠️ 发现旧收藏数据，建议迁移');
                    if (confirm('检测到旧版收藏数据，是否迁移到新系统？')) {
                        oldFavorites.forEach(recipeId => {
                            window.UserPreferences.addFavorite(recipeId);
                        });
                        localStorage.removeItem('favorites'); // 清除旧数据
                        showToast(`已迁移 ${oldFavorites.length} 个收藏到新系统`, 'success');
                        window.userCenterPage.updateAllStats();
                    }
                }
            } else {
                console.error('❌ UserPreferences 系统未加载');
            }
        }
    </script>
</body>
</html>